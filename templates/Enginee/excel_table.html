
{% extends "base.html" %}
{% block content %}

<link rel="stylesheet" href="{{ url_for('static', filename='css/table-excel.css') }}" />

<main class="container">
  <div class="table-header d-flex justify-content-between align-items-center">
    <h2>{{ page_title }}</h2>
  <div id="table-info" class="badge bg-primary p-2">Linhas: {{ data|length }} | Colunas: {{ data[0].keys()|length }}</div>
  </div>

  <div style="overflow: auto; max-width: 100%; max-height: 70vh;">
    <table id="excelTable" class="table table-bordered table-striped mt-3" style="width: 100%; min-width: 1000px;">
      <thead>
        <tr>
          {% for col in data[0].keys() %}
            <th>{{ col }}</th>
          {% endfor %}
        </tr>
        <tr class="filter-row">
          {% for col in data[0].keys() %}
            <th><input type="text" placeholder="Filtrar..." onkeyup="filterTable({{ loop.index0 }})"></th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for row in data %}
          <tr>
            {% for value in row.values() %}
              <td>{{ value }}</td>
            {% endfor %}
          </tr>
        {% endfor %}
      </tbody>
    </table>
</div>
</main>


<script>

function filterTable(colIndex) {
  const table = document.getElementById("excelTable");
  const filter = table.tHead.rows[1].cells[colIndex].firstElementChild.value.toUpperCase();
  const tbody = table.tBodies[0];
  let visibleRows = 0;

  for (let row of tbody.rows) {
    const cell = row.cells[colIndex];
    if (cell.textContent.toUpperCase().indexOf(filter) > -1) {
      row.style.display = "";
      visibleRows++;
    } else {
      row.style.display = "none";
    }
  }

  // Atualiza contador de linhas
  const totalCols = table.tHead.rows[0].cells.length;
  document.getElementById("table-info").textContent = `Linhas: ${visibleRows} | Colunas: ${totalCols}`;
}


</script>

{% endblock %}
